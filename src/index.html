<!DOCTYPE html>
<html>

<head>
    <script src="system.js" type="text/javascript"></script>
    <script src="touch.js" type="text/javascript"></script>
    <script src="shape.js" type="text/javascript"></script>
    <script src="select.js" type="text/javascript"></script>
    <script src="command.js" type="text/javascript"></script>
    <script src="page.js" type="text/javascript"></script>
    <script src="deck.js" type="text/javascript"></script>
    <script src="tool.js" type="text/javascript"></script>
    <script src="board.js" type="text/javascript"></script>

    <style>
    #canvas {
        background-color: lightGrey;
    }
    .button {
        display: inline-block;
        border: 1px solid black;
        margin: 4px;
        padding: 2px;
        user-select: none;
        -webkit-user-select: none;
        cursor: pointer;
    }
    .current {
        border: 4px solid blue;
        margin: 0px;
    }
    </style>

    <script type="text/javascript">
    var board = null;
    var tool = "";
    var page = "";
    var deck = "";
    var panZoomTool = null;
    var autoTemplateTool = null;
    var alphaFillTool = null;
    var locationTool = null;
    var pictureTool = null;

    function setTool(newTool) {
        if (tool) {
            var elem = document.getElementById(tool);
            if (elem)
                elem.classList.remove("current");
        }

        tool = newTool;
        switch (newTool) {
            case "autoTemplate":
                board.setTools([pictureTool, autoTemplateTool, panZoomTool]);
                break;
            case "alphaFill":
                board.setTools([pictureTool, alphaFillTool, panZoomTool]);
                break;
            case "panZoom":
                board.setTools([pictureTool, panZoomTool]);
                break;
            case "location":
                board.setTools([pictureTool, locationTool]);
        }

        if (newTool) {
            var elem = document.getElementById(newTool);
            if (elem)
                elem.classList.add("current");
        }
    }

    function setPage(newPage) {
        if (page)
            document.getElementById(page).classList.remove("current");

        page = newPage;
        board.setPageByName(newPage);

        if (newPage) {
            document.getElementById(newPage).classList.add("current");
        }

        switch (newPage) {
            case "board":
                setTool("boardPanZoom");
                break;
            case "deck":
                setTool("deckPanZoom");
                break;
            case "cutout1":
                setTool("alphaFill");
                break;
        }
    }

    function setDeck(newDeck) {
        if (deck)
            document.getElementById(deck).classList.remove("current");

        deck = newDeck;
        board.setDeckByName(newDeck);

        if (newDeck) {
            document.getElementById(newDeck).classList.add("current");
        }
    }

    function clickTool(e) {
        setTool(e.target.id);
    }

    function clickPage(e) {
        setPage(e.target.id);
    }

    function clickDeck(e) {
        setDeck(e.target.id);
    }

    function clickUndo(e) {
        board.undo();
    }

    function clickRedo(e) {
        board.redo();
    }

    function addPicture(e) {
        var file = e.target.files[0];
        e.target.value = "";
        if (!file)
            return;

        var reader = new FileReader();
        reader.onloadend = function(e) {
            pictureTool.addPicture(reader.result);
        }
        reader.readAsDataURL(file);
    }

    window.onload = function() {
        board = new DeckMaker.Board(document.getElementById('canvas'));

        document.getElementById("board").addEventListener("click", clickPage);
        document.getElementById("deckPage").addEventListener("click", clickPage);
        document.getElementById("cutout1").addEventListener("click", clickPage);

        document.getElementById("panZoom").addEventListener("click", clickTool);
        document.getElementById("autoTemplate").addEventListener("click", clickTool);
        document.getElementById("alphaFill").addEventListener("click", clickTool);
        document.getElementById("picture").addEventListener("change", addPicture);
        document.getElementById("location").addEventListener("click", clickTool);

        document.getElementById("deck1").addEventListener("click", clickDeck);
        document.getElementById("deck2").addEventListener("click", clickDeck);
        document.getElementById("deck3").addEventListener("click", clickDeck);
        document.getElementById("deck4").addEventListener("click", clickDeck);

        document.getElementById("undo").addEventListener("click", clickUndo);
        document.getElementById("redo").addEventListener("click", clickRedo);

        var boardPage = new DeckMaker.LayerPage("board");
        board.addPage(boardPage);

        boardPage.addLayer(new DeckMaker.Layer("picture"));
        boardPage.addLayer(new DeckMaker.Layer("location"));
        boardPage.addLayer(new DeckMaker.Layer("tool"));

        var deck1 = new DeckMaker.Deck("deck1");
        var deck2 = new DeckMaker.Deck("deck2");
        var deck3 = new DeckMaker.Deck("deck3");
        var deck4 = new DeckMaker.Deck("deck4");
        board.addDeck(deck1).addDeck(deck2).addDeck(deck3).addDeck(deck4);

        var deckPage = new DeckMaker.DeckPage("deckPage");
        board.addPage(deckPage);

        var cutout1 = new DeckMaker.LayerPage("cutout1");
        board.addPage(cutout1);

        cutout1.addLayer(new DeckMaker.Layer("picture"));
        cutout1.addLayer(new DeckMaker.Layer("template"));
        cutout1.addLayer(new DeckMaker.Layer("tool"));

        alphaFillTool = new DeckMaker.AlphaFillTool();
        autoTemplateTool = new DeckMaker.AutoTemplateTool();
        panZoomTool = new DeckMaker.PanZoomTool();
        locationTool = new DeckMaker.LocationTool();
        pictureTool = new DeckMaker.PictureTool();

        setPage("cutout1");
        setTool("alphaFill");
        setDeck("deck1");
    }
    </script>
</head>

<body>
    <div id="board" class="button">BOARD</div>
    <div id="deckPage" class="button">DECK</div>
    <div id="cutout1" class="button">CUTOUT 1</div>
    <div></div>
    <input id="picture" type="file"></input>
    <div></div>
    <div id="autoTemplate" class="button">AUTO TEMPLATE</div>
    <div id="alphaFill" class="button">ALPHA FILL</div>
    <div id="panZoom" class="button">PAN/ZOOM</div>
    <div id="location" class="button">LOCATION</div>
    <div></div>
    <div id="deck1" class="button">DECK1</div>
    <div id="deck2" class="button">DECK2</div>
    <div id="deck3" class="button">DECK3</div>
    <div id="deck4" class="button">DECK4</div>
    <div></div>
    <div id='undo' class="button">UNDO</div>
    <div id='redo' class="button">REDO</div>
    <div></div>
    <canvas id="canvas" width="400" height="400"></canvas>
</body>

</html>
